groups:
  - name: nodeScaleAlert
    rules:
      - alert: node_tooFewConsumers_smallOverhead
        expr: org_apache_activemq_Broker_QueueSize{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} >= ${AMQ_SMALL_UNACK_CNT} and org_apache_activemq_Broker_ConsumerCount{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} < ${AMQ_SMALL_CONSUMER_CNT}
        # expr: up{instance="localhost:9090",job="services"} < 3 
        for: 0m 
      - alert: node_tooFewConsumers_mediumOverhead
        expr: org_apache_activemq_Broker_QueueSize{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} >= ${AMQ_MEDIUM_UNACK_CNT} and org_apache_activemq_Broker_ConsumerCount{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} < (${AMQ_MEDIUM_CONSUMER_CNT} + ${AMQ_SMALL_CONSUMER_CNT})
        for: 0m 
      - alert: node_tooFewConsumers_largeOverhead
        expr: org_apache_activemq_Broker_QueueSize{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} >= ${AMQ_LARGE_UNACK_CNT} and org_apache_activemq_Broker_ConsumerCount{brokerName="localhost", destinationName="nodequeue", destinationType="Queue", instance="activemq:8080", job="services"} < (${AMQ_LARGE_CONSUMER_CNT} + ${AMQ_MEDIUM_CONSUMER_CNT} + ${AMQ_SMALL_CONSUMER_CNT})
        for: 0m 
      - alert: node_tooManyConsumers_largeOverhead
        expr: org_apache_activemq_Broker_QueueSize{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} < ${AMQ_LARGE_UNACK_CNT} and org_apache_activemq_Broker_ConsumerCount{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} >= (${AMQ_LARGE_CONSUMER_CNT} + ${AMQ_MEDIUM_CONSUMER_CNT} + ${AMQ_SMALL_CONSUMER_CNT})
        for: 0m 
      - alert: node_tooManyConsumers_mediumOverhead
        expr: org_apache_activemq_Broker_QueueSize{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} < ${AMQ_MEDIUM_UNACK_CNT} and org_apache_activemq_Broker_ConsumerCount{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} >= (${AMQ_MEDIUM_CONSUMER_CNT} + ${AMQ_SMALL_CONSUMER_CNT})
        for: 0m 
      - alert: node_tooManyConsumers_smallOverhead
        expr: org_apache_activemq_Broker_QueueSize{brokerName="localhost", destinationName="${AMQ_NODE_QUEUE_NAME}", destinationType="Queue", instance="activemq:8080", job="services"} < ${AMQ_SMALL_UNACK_CNT} and org_apache_activemq_Broker_ConsumerCount{brokerName="localhost", destinationName="nodequeue", destinationType="Queue", instance="activemq:8080", job="services"} >= ${AMQ_SMALL_CONSUMER_CNT}
        for: 0m 

  - name: springScaleAlert
    rules:
      - alert: ql1_cl0
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } > ${ql0}
          and 
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } <= ${ql1}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } == ${cl0}
        for: 0m 
      - alert: ql2_cl0
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } > ${ql1}
          and 
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } <= ${ql2}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } == ${cl0}
        for: 0m 
      - alert: ql3_cl0
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } > ${ql2}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } == ${cl0}
        for: 0m 
      - alert: ql0_cl1
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } >= 0
          and 
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } <= ${ql0}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } > ${cl0}
          and
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${cl1}
        for: 0m 
      - alert: ql2_cl1
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } > ${ql1}
          and 
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } <= ${ql2}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } > ${cl0}
          and
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${cl1}
        for: 0m 
      - alert: ql3_cl1
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } > ${ql2}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } > ${cl0}
          and
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${cl1}
        for: 0m 
      - alert: ql0_cl2
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } >= 0
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${ql0}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } > ${cl1}
          and
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${cl2}
        for: 0m 
      - alert: ql1_cl2
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } > ${ql0}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${ql1}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } > ${cl1}
          and
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${cl2}
        for: 0m 
      - alert: ql3_cl2
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } > ${ql2}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } > ${cl1}
          and
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${cl2}
        for: 0m  
      - alert: ql0_cl3
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } >= 0
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${ql0}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } > ${cl2}
          and
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${cl3}
        for: 0m 
      - alert: ql1_cl3
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } > ${ql0}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${ql1}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } > ${cl2}
          and
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${cl3}
        for: 0m 
      - alert: ql2_cl3
        expr: >
          org_apache_activemq_Broker_QueueSize{
           brokerName="localhost", 
           destinationName="${AMQ_SPRING_QUEUE_NAME}",
           destinationType="Queue", 
           instance="activemq:8080", job="services"
          } > ${ql1}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${ql2}
          and 
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } > ${cl2}
          and
          org_apache_activemq_Broker_ConsumerCount{
           brokerName="localhost",
           destinationName="${AMQ_SPRING_QUEUE_NAME}", 
           destinationType="Queue",
           instance="activemq:8080", 
           job="services"
          } <= ${cl3}
        for: 0m 